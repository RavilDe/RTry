---
title: "Основы программирования на R"
author: "Антон Антонов"
output: 
    html_document:
        highlight: tango
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, cache = T)
```

# 1. Базовые структуры и понятия
## 1.1 Введение в курс
### 1.1.1 Введение
#### Немного об автор курса Антоне Антонове 
* Академическая математика (вычислительные стохастические методы)
* Количественная финансовая математике (алгоритмическая торговля)
* Open source contributions: [github.com/tonytonov](https://github.com/tonytonov)
* StackOverflow: [stackoverflow.com/users/1900149/tonytonov](https://stackoverflow.com/users/1900149/tonytonov)
* St. Petersburg R User Group: [vk.com/spbrug](https://vk.com/spbrug), [meetup.com/St-Petersburg-R-User-Group ](http://meetup.com/St-Petersburg-R-User-Group )

#### Почему R?
* Объемы данных растут
* Это настоящий язык программирования
* Он бесплатен, кроссплатформен, расширяем, у него огромное сообщество

#### Почему программирование?
Есть два типа знакомства с R:

* Первый тип знакомства с R: обучение конкретным методам
* Второй тип:
    + Как устроены объекты языка?
    + Почему они ведут себя имнно так?
    + Как их можно эффективно использовать?
    + Основная цель: ускорить переход от простого к сложному
    
Мы пойдем по **второму пути**!
    
#### Почему "основы"?
* Курс покрывает основные объекты и семантические принципы
* Рассматриваются типичные ошибки и сложности при работе с R
* Материал универсален и не заточен под специфику данных какой-то области

#### Материалы курса
* Все материалы доступны на [https://github.com/tonytonov/Rcourse](github.com/tonytonov/Rcourse)
* Рекомендуемые книги:
    + Norman Matloff "The Art of R Programming"
    + Richard Cotton "Learning R"
    + Hadley Wickham "Advanced R" (после года программирования)
    
#### Рекомендации по прохождению
* Сложность курса возрастает:
    + первая неделя -- "easy"
    + вторая неделя -- "normal"
    + третья неделя -- "hard"
* Задания можно пропускать и возвращаться к ним позже
* Если что-то непонятно, ищите аналогичные темы в справке, книгах и интернете
* Побольше экспериментов!
* Don't give up easily :)

## 1.2 Переменные, глобальное окружение, справка
### 1.2.1 План урока
В этом уроке мы

* узнаем, чем хорош (и не очень хорош) R;
* научимся использовать встроенную справку;
* будем создавать, изменять и удалять переменные в глобальном окружении;
* используем функции с аргументами и без;
* напишем свои собственные функции.

### 1.2.2
#### Что такое R
* R -- язык программирования для научных вычислений и анализ данных с упором на визуальзацию и воспроизводимость
* R -- свободное кросс-платформенное программное обеспечение с открытым исходным кодом
* R -- интерпретируемый язык с интерфейсом командной строки (его не нужно компилировать)
* R -- мультипарадигменный язык, сочетающий в себе
    1. функциональное 
    2. процедурное
    3. объектно-ориентированное
    4. рефлексивное программирование
    
#### Плюсы
* R беспалтен, его код открыт
* Огромное количество встроенных статических тестов, математических алгоритмов, функций для анализа данных в академических и отраслевых исследованиях
* Расширяемость: модульная система пакетов (packages)
* Обширное сообщество разработчиков
* Полностью программируемая высокоуровневая графика
* Кросс-плватформенность, воспроизводимость результатов
* R становится популярным: статьи, книги, конференции, юзер группы

#### Минусы
* R достаточно сложен как язык программирования
* Документация некоторых методов труднодоступна без глубокого знания математических методов и статистических процедур
* Легко написать плохой (медленный, неподдерживаемый, нечитаемый) код
* Пакеты дополнений устаревают
* Можно заметить некоторую непоследовательность в именовании переменных и реализации методов

#### Помогите, ничего не работает!
* Это нормально
* Внимательно читаем текст ошибок и предупреждений
* Встроенная справка: `help("sin")`, `help.search("logarithm")`
* <https://cran.r-project.org/doc/FAQ/R-FAQ.html>
* Пользуемся поисковыми системами
* R Mailing List Archive
* [stackoverflow.com](https://stackoverflow.com)

### 1.2.3 Задача
В этом тесте отметьте верные утверждения о характеристиках языка R.
Итак, правда ли, что R:

* это язык с проприетарным (закрытым) кодом?
* чрезвычайно прост в освоении?
* создан для коммерческого использования?
* требует компиляции перед исполнением кода?
* **сочетает в себе несколько различных стилей (парадигм) программирования?**
* **это язык с открытым исходным кодом?**

### 1.2.4 Задача

### 1.2.5 Запускаем Rstudio
#### Встроенная справка
```{r}
help("sin")
```

Справка состоит из нескольких частей:

* Description -- описание на человеческом языке
* Details -- важные детали и подробности
* Value -- возвращаемое значение
* Examples -- примеры использования

В `R` одинарные и двойные кавычки **равнозначны**:
```{r}
help('sin')
```

А для некторых функций можно вообще не укхывать имя в кавычках:
```{r}
help(sin)
```

Это правило не работает например для зарезервированных слов:
```{r}
# help(for) # выполнение кода выдаст ошибку
help("for")
```

Вместо функции `help` можно использовать знак вопроса `?`:
```{r}
?sin
```

Ну и если мы хотим спросить что-то "запретное":
```{r}
?"function"
```

Во вкладке `History` появилась история наших действий в консоли. Тут есть поиск, иногда это полезно.

### 1.2.6 Задача
Воодушевлённый предыдущим видео, я решил посмотреть справку по использованию оператора if. 

Что произойдёт, если я наберу в консоли 
`?if`
и нажму Enter?

#### Решение
* Справка не откроется, потому что Enter нужно нажать ещё раз.
* **Справка не откроется: if -- зарезервированное слово, которое надо заключать в кавычки.**
* Откроется справка по циклам.
* Откроется справка с перечнем зарезервированных слов.
* Справка не откроется, потому что такого оператора нет, вместо него есть оператор ifelse.
* Следующий шагРешить снова

### 1.2.7 Задача
В R есть функция, которая реализует алгоритм [быстрого преобразования Фурье](https://en.wikipedia.org/wiki/Fast_Fourier_transform). Круто, да?

Попробуйте найти название этой функции поиском по справке или в google. 

Подсказки:

* Название алгоритма на английском можно узнать по ссылке выше.
* R чувствителен к регистру, то есть функция cos существует, а `COS` или `cOs` -- нет.
* Ответ содержит не более шести символов.

#### Решение
`fft`

### 1.2.8
#### Основы основ
* R -- интерпретируемый язык
* Команды исполняются построчно
* Командная строка расположена во вкладке "Console" в RStudio
```{r}
2 + 1
sin(pi/6)
```

#### Переменные
Нам не очень интересно использоват R как калькулятор. Мы хотим использовать понятия переменной и функции. Начнем с переменных. Чтобы создать переменную необходимо использовать оператор присваивания `<-` (Alt + -).

Обычно в языках программирования опертором присваивания является знак равно `=`. В R он тоже используется, но немного в других случаях.

Предположим, что мы хотим посчитать количество питомце в доме. Создадим две переменные `cats` и `dogs`, а затем их сумму присвоим новой переменной `pets`.
```{r}
cats <- 5
dogs <- 2
pets <- cats + dogs
```

Напечатано ничего не будет, просто сохранится переменная. Проверим, сохранилась ли переменная `pets`. Для этого необходимо просто написать ее имя:
```{r}
pets
```

Не любое имя переменной считается валидным!

#### Глобальное окружение
Поговорим о том месте, где живут созданные нами переменные.

* Каждая переменная определяемая нами живет в собственном *окружении*
* Окружение переменной -- это пространство, где ее можно найти; то место где она считается определенной
* Те переменные, что мы создали ранее, попадают в *глобальное окружение*; это то окружение, которое создается и считается самым широким
* Переменные из глобального окружения доступны во вкладке "Environment" в RStudio
* Либо можно просто ввести команду `ls()` в консоли
```{r}
ls() # list objects
```

#### Вызов функции
Поподробнее остановимся на функцииях и их аргументах, как их можно указывать.

В R опредеелно множество встроенных функций, например `rnorm`
```{r}
?rnorm    # посмотрим на справку по этой функции
rnorm(15) # генерирует 15 случайных чисел из нормального распределения
```

Аргументы функции можно указать по имени, через запятую по правилу ключ --> значение.
```{r}
rnorm(15, mean = 5, sd = 3)
```

На этом примере видет принцип разделение присваивания (`<-` и `=`): если мы указываем значение для переменной, то `<-`, если указываем значение аргумента, то используем оператор `=`.

#### Написание функций
Не всегда мы будем использовать уже существующие функции. Мы захотим использовать свои функции!

Для определения новой функции существует ключевое слово `function`; в круглых скобках *аргументы* функции, в фигурных -- **тело** функции (её код):
```{r}
returnTwo <- function(){
  y <- 2
  return(y)
}
```




#### Из коментов. Вопрос про `rm()` vs `qs()`
**Илья Ильюшёнок**
Сталкивался с тем, что `rm()` удаляет переменные из окружения, но в памяти они продолжают занимать место. Недавно узнал о существовании функции `gc()`. Пробовал сочетание `rm(value)` и `gc()` - помогает. Возможно, есть ещё какие-то способы решения этой проблемы?

**Антон Антонов**
Хороший вопрос, спасибо. Вы всё делаете правильно. На самом деле, `rm` действительно не высвобождает память, а просто уничтожает имя переменной. Память освобождается сборщиком мусора, который вызывается либо самим R, либо вручную (`gc` -- garbage collector). Манипулирование памятью в R -- достаточно хитрый механизм, и, строго говоря, даже вызов gc вручную не всегда гарантирует освобождение памяти. Похожий вопрос есть на [stackoverflow](http://stackoverflow.com/questions/1467201/forcing-garbage-collection-to-run-in-r-with-the-gc-command).










