---
title: "Основы Статистики"
author: "Анатолий Карпов"
output:
  html_document: default
  pdf_document: default
  word_document: default
header-includes: \usepackage[english, russian]{babel}
---

```{r setup, include = FALSE}
library(ggplot2)
library(dplyr)
knitr::opts_chunk$set(echo = FALSE, message = F, warning = F)
```
## 1. Введение (первая неделя)
### 1.1 Информация о курсе
Этот курс посвящен введению в статистику. Этот курс будет состоять из трех недель:

* **первая неделя** - вводная, поговорим о базовых понятиях - выборка, генеральная совокупность,
описательные статистики; разберемся с фразой Статистически значимые различия
* **вторая неделя** - регерессионный анализ, t-критерий, ANOVA
* **третья неделя** - корреляция и регрессия


### 1.2 Генеральная совокупность и выборка
#### 1.2.1 План урока

* Понятие генеральной совокупности и выборки, репрезентативность выборки
* Простая случайная выборка
* Стратифицированная выборка
* Групповая выборка

#### 1.2.2 Лекция
**Генеральная совокупность** - множество всех тех объектов, относительно
которых мы будем делать выводы.

Например статистика по росту вех людей побывавших на луне; **ГС** будет
все эти люди, их легко посчитать, изиерить рост и т.д. Но в большинстве случаев
объемы **ГС** очень велики (в некоторых биологических исследованиях объем
популяции может насчитывать несколько тысяч представителей).
Для того чтобы решить эту проблему исследователь выбирает только часть
**ГС** т.е. формирует **выборку**:

**Выборка** - часть **ГС**, результаты исследования которой можно обообщить
на **ГС**.

Очень важным условием является репрезентативность выборки, т.е. мы хотим чтобы
наша **выборка** была моделью **ГС**, отражала свойства **ГС**.

Чтобы этого добиться существует несколько вариантов формирования репрезентативной выборки.

#### 1.2.3 Задача
Если мы провели исследование с целью выявить уровень знаний в области биологии
на 100 студентах биологического факультета СПбГУ, то на какую совокупность мы
можем распространить наши выводы?

Варианты ответов:

+ Студенты СПБГУ
+ **Студенты биологического факультета СПБГУ**
+ Мужчины и женщины в возрасте от 18 до 22 лет

#### 1.2.4 Задача
Если объем выборки достаточно велик (больше 100), то такая выборка
является репрезентативной?

* Да
* Нет
* **Зависит от способа формирования выборки**

#### 1.2.5 - 1.2.7 Лекции
Виды выборок:

* **Простая случайная выборка (simple random sample)** - случайным образом выбираем элементы **ГС**;
чем больше будет объем выбранных объектов, тем сильнее наша выборка будет походить на **ГС** по
своим характеристикам.
* **Стратифицированная выборка (stratified sample)** - разбиваем **ГС** на несколько обособленных групп
(strat) различных по своей природе, а уже после осуществляем выборку.
* **Групповая выборка (cluster sample)** - разбиваем **ГС** на кластеры очень похожие между собой
и уже из них случайным образом осуществляем выборку.

#### 1.2.8 Задача
Соотнесите способы формирования выборки с предложенными примерами.

**А**. Для того чтобы протестировать курс по введению в статистику и выяснить, насколько хорошо с ним справятся студенты Института биоинформатики, случайным образом было выбрано 50 студентов института.

**Б**. Для исследования взаимосвязи риска развития заболевания и группы крови человека потенциальных участников исследования разделили на четыре группы (в соответствии с группой крови). Затем из каждой группы случайным образом извлекли по 50 человек.

**В**. Чтобы проверить знания школьников Санкт-Петерубрга по математике, было организовано исследование. Случайным образом было выбрано 10 школ, затем из каждой школы случайным образом было отобрано по 50 учащихся разных классов.

Ответы:

* А - Простая случайная выборка (random sample)
* Б - Стратифицированная выборка (stratified sample)
* В - Групповая выборка (cluster sample)

#### 1.2.9 Задача
Предположим, после лекции по статистике, один студент решил выяснить, как хорошо
**студенты психологического факультета** разбираются в этом предмете.
Он подготовил серию заданий и пригласил 30 своих друзей с факультета принять
участие в тестировании. Исследователь утверждает, что он сформировал
простую случайную выборку. Так ли это?

* **Это не простая случайная выборка. Не каждый член генеральной совокупности
мог равновероятно принять участие в тестировании, т.к. исследователь позвал
только своих друзей**.
* Такая выборка должна рассматриваться, как стратифицированная выборка.
Можно сказать, что исследователь разделил всех студентов на страты по 30
человек и выбрал только одну из них для исследования.
* Такая выборка может рассматриваться, как простая случайная выборка.
Тридцать человек действительно являются студентами данного факультета.

### 1.3 Типы переменных
#### 1.3.1 План урока

* Типы переменных
* Количественные переменные
* Номинативные переменные
* Ранговые переменные

#### 1.3.2 - 1.3.4 Лекции
Глобально все переменные можно разделить на два типа - **количественные**
и **качественные** (номинативные)

**Количественные переменные** - измеренные значения некоторого признака.
Если переменная может принимать любое значение на промежутке, то такая
переменная называется **непрерывной**. Например рост испытуемых может оказаться
в промежутке от 160 до 190 см. **Дискретные** количественные переменные принимают только
определенные значения. Например количество детей в семье.

**Номинативные** (качественные) переменные используются для разделения наших испытуемых
(объектов) на группы. Напоимер, все участники женского пола будут обозначены
цифрой **1**, а участники мужского пола - цифрой **2**

В номинативных переменных за цифрами не стоит никакого математического смысла.
В данном случае цифры это всего лишь маркеры или лейблы, которые делят
наших испытуемых на группы

#### 1.3.5 Задача
Какие из перечисленных переменных, вероятнее всего, являются дискретными?

* **Число слушателей онлайн курса по статистике, набравших максимальный балл**
* Пол человека
* Имена ваших друзей
* Средний годовой доход
* Расстояние от Санкт-Петербурга до других городов России
* **Количество домашних животных в семье**

#### 1.3.6 Лекция
**Ранговые переменные** - упорядоченные дискретные перменные.
Например финиширующие в марафонском беге.

#### 1.3.7 Задача
Два основных типа переменных в статистике:

* Непрерывные и количественные
* **Качественные и количественные**
* Качественные и номинативные
* Ранговые и номинативные

#### 1.3.8 Задача
Соотнесите примеры переменных и их типы:

* Количественная (дискретная) переменная - Количество публикаций у ученого
* Количественная (непрерывная) переменная - Рост в мм
* Ранговая переменная - Успевавемость студентов (упорядоченный список студентов по успеваемости)
* Номинативная переменная - Группа крови

#### 1.3.9 Задача
Если рост 10 участников исследования представлен в ранговой шкале (по убыванию: 1-самый высокий, 2 - ниже и т.д.), тогда верным утверждением будет:

* Испытуемый с рангом 4 на два см ниже, чем испытуемый с рангом 6.
* Ни одно из утверждений верным не является.
* У испытуемых с рангом 1 и 3 такая же разница в росте, как и у испытуемых с рангами 3 и 5.
* **Испытуемый с рангом 4 выше, чем испытуемый с рангом 6, но ниже, чем испытуемый с рангом 2.**

### 1.4 Меры центральной тенденции
#### 1.4.1 План урока

* Понятие описательной статистики
* Мода
* Медиана
* Среднее значение
* Выбор меры центральной тенденции
* Свойства среднего

#### 1.4.2 Лекция
**Эмпирические данные** - данные полученные опытным путём.

**Описательная (дескриптивная) статистика** - обработка данных полученных эмпирическим путём и их систематизация, наглядное представление в форме графиков, таблиц, а также их количественное описание посредством основных статистических показателей.

**Распределение вероятностей** - это закон, описывающий область значений случайной величины и вероятность её появления (частоту) в данной области. То есть насколько часто X появляется в данном диапазоне значений.

**Гистограмма частот** - ступенчатая функция показывающая насколько часто вероятно появление величины в указанном диапазоне значений.

#### 1.4.3 Лекция
**Мода (Mode)** - значение измеряемого признака, которое встречается максимально часто.

```{r, fig.height = 3}
# fig.height - размер изображение после knit'a
# цвета для графиков взяты здесь http://colorbrewer2.org/
a <- c(157, 159, 161, 164, 165, 166, 167, 167, 167, 168,
       169, 169, 170, 170, 170, 171, 171, 172, 172, 172,
       172, 173, 173, 175, 175, 177, 178, 178, 179, 185)
d <- data.frame(height = a)                 # основные данные
d_mode <- data.frame(height = rep(172, 4))
g <- ggplot() +
  geom_dotplot(data = d, aes(height)) +
  scale_x_continuous(breaks = seq(155, 190, 5)) +
  scale_y_continuous(limits = c(0, 12.1),    # 12.1 - найдено методом математического подгона
                     breaks = seq(0, 12, 4))
g + geom_dotplot(data = d_mode, aes(height), color = "#1b9e77", fill = "#1b9e77") +
  annotate("text", x = 172, y = 6.5,
           label = "mode = 172", size = 5, color = "#1b9e77")
```

Если из нашей выборки удалить всего одно значени **172**, то она получит три моды.

#### 1.4.4 Лекция

**Медиана (Median)** - значение признака,которое делит упорядоченное множество пополам

Сначала нужно упорядочить выборку, а потом найти такое значени, которое поделит ее на две равные части.
Возьмем первые девять элементов нашей выборки:

```{r, fig.height = 3}
d_sml <- d %>% slice(1:9)
ggplot(d_sml, aes(height)) +
  geom_vline(data = d_sml, aes(xintercept = median(height)),
             color = "#7570b3", linetype = "dotted", size = 1) +
  geom_dotplot() +
  scale_x_continuous(breaks = seq(155, 168, 1)) +
  scale_y_continuous(limits = c(0, 12.1),
                     breaks = seq(0, 12, 3)) +
  annotate("text", x = 163.5, y = 6,
           label = "median = 165", color = "#7570b3", size = 5)
```

В данном случае четыре слева и четыре справа; медиана равна **165**.

Теперь возьмем все данные:

```{r, fig.height = 3}
g + geom_vline(data = d, aes(xintercept = median(height)),
             color = "#7570b3", linetype = "dotted", size = 1) +
  annotate("text", x = 174.6, y = 6,
           label = "median = 170.5", size = 5, color = "#7570b3")
```

Точка, которая будет делить наши данные на две равные части, находится между
**170** и **171**; в данном случае медианой будет являться среднее значение
двух признаков: $$M_{e} = \frac{170 + 171}{2} = 170.5$$

#### 1.4.5 Лекция
**Среднее значение (mean, среднее арифметическое)** - сумма всех измеренных
признаков, деленное на их количество.

```{r, fig.height = 3}
g + geom_vline(data = d, aes(xintercept = mean(height)),
             color = "#d95f02", linetype = "dotted", size = 1) +
  annotate("text", x = 174.6, y = 6,
           label = "mean = 170.4", size = 5, color = "#d95f02")
```

Расчет среднего для выборки: $$\bar{x} = \frac{x_1 + x_2 + ... x_{30}}{30} = 170.4$$

Для обозначения среднего в **ГС** используется $M$

#### 1.4.6 Лекция
В нашем случае все три меры центральной тенденции оказались очень близки друг к другу

```{r, fig.height = 3}
g + geom_dotplot(data = d_mode, aes(height), color = "#1b9e77", fill = "#1b9e77") +
  geom_vline(data = d, aes(xintercept = mean(height)),
             color = "#d95f02", linetype = "dotted", size = 1) +
  geom_vline(data = d, aes(xintercept = median(height)),
             color = "#7570b3", linetype = "dotted", size = 1) +
  annotate("text",
           x = c(175, 167, 175),
           y = c(6, 10, 10),
           label = c("mode = 172","mean = 170.4", "median = 170.5"),
           size = 5,
           color = c("#1b9e77", "#d95f02", "#7570b3"))
```

$\bar{x} = 170.4$ - среднее
$M_{e} = 170.5$ - медиана  
$M_{o} = 172$ - мода  

#### 1.4.10 Лекция
Если распределение симметричено, унимодально (одна мода) и не имеет заметных выбросов,
то можно использовать любую из мер центральной тенденции; среднее, мода и медиана дадут
примерно одинаковые значения.

Однако, если у распределения есть ярковыраженная ассиметрия, заметны выбросы или несколько мод,
тогда использование среднего значения может привести к некорректным результатам; гораздо лучше использовать моду или медиану.

#### 1.4.11 Задача
В каких случаях вместо среднего значения лучше использовать моду или
медиану в качестве центральной тенденции?

* Если распределение является симметричным и унимодальным
* **Если распределение асимметрично**
* **Если присутствуют заметные выбросы**

#### 1.4.12 Лекция
**Свойства среднего**

$M_{x + c} = M_{x} + c$ - если  к каждому значению нашей выборки добавить константу
то и среднее значение выборки умеличится на жту константу. Графически это выглядит как смещенная вправо кривая распределения.

$M_{x * c} = M_{x} * c$ - тоже самое и  с умножением.

$\sum (x_{i} - M_{x}) = 0$ - сумма отклонений от среднего арифметического равна нулю.

#### 1.4.13 Задача
Как соотносятся средние значения двух рядов чисел:

$$
\begin{array}
{rrrrrrrrrrrrrr}
 1 &3 &1 &3 &7 &8 &9 &10 &12 &12 &13 &18 &20 &19 \\
 2 &6 &2 &6 &14 &16 &18 &20 &24 &24 &26 &36 &40 &38
\end{array}
$$

Постарайтесь ответить на вопрос, не рассчитывая средние значения,
но используя свойства среднего арифметического

Ответы:

* **Среднее второго ряда чисел в два раза больше**
* Средние значения равны
* Среднее второго ряда чисел в два раза меньше

### 1.5 Меры изменчивости
#### 1.5.1 План урока
* Понятие меры изменчивости данных
* Размах
* Дисперсия, стандартное отклонение
* Свойства дисперсии и стандартного отклонения

#### 1.5.2 Лекция
#### 1.5.3 Лекция
**Размах (Range)** - разность максимального и минимального значения.

$$R = X_{max} - X_{min} = 185 - 157 = 28$$

**Недостаток**: эта мера показывает изменчивость данных, используя только два
крайних значения; любое изменение крйнего значения сильно повляет на меру.

Поэтому гораздо интереснее рассчитать изменчивость данных используя
каждое из значений.

#### 1.5.5 Лекция
Как же нам использовать все без исключения значения признака для расчета
меры изменчивости? Один из возможных вариантов это посмотретть насколько в среднем
наши значения отклоняются от среднего значения в нашей выборке.

**Дисперсия (varieace)** - средний квадрат отклонений индивидуальных значений
признака от их средней величины.

$$D = \frac{\sum_{i=1}^n(x_{i} - \bar{x})^2}{n}$$
Но т.к. мы возвели числитель в квадрат, то показатель дисперсии будет превышать реальные
отклонения наших наблюдений от среднего по выброрке. Чтобы вернуться к исходным единицам измерения
извлечем квадратный корень из получившейся дисперсии и получим **среднеквадратическое отклонение**:

$$\sqrt{D} = \sigma$$

И в отличие от дисперссии $\sigma$ показывает реальное среднее значение наших
отклонений от средней величины.

**Различные обозначения:**
$\sigma$ - ско для **ГС**
sd (standart deviation) - ско для выборки (или просто **стандартное отклонение**)

Формула для расчета дисперсии **выборки** будет немного другая:
$$D = \frac{\sum_{i=1}^n(x_{i} - \bar{x})^2}{n - 1}$$

#### 1.5.7 Задача
Укажите, в какой из выборок наибольшее стандартное отклонение:

(1)  1 3 2 4 5 7 1 8  
(2) **100 300 250 400 230 280 320 112**  
(3) 15 10 13 7 28 31 20 32  

P.S. задание можно решить без расчетов.

#### 1.5.8 Лекция
$Выборка:\begin{array}{rrrrrrr} 1& 2& 2& 3& 4& 4& 5 \end{array}$

$M_x = 3$ - среднее значение выборки

<!-- $$\begin{equation} -->
<!--  D = \frac{(1-3)^2+(2-3)^2+(2-3)^2+(3-3)^2+(4-3)^2+(4-3)^2+(5-3)^2}{7-1}= \\ -->
<!--  =  \frac{4+1+1+0+1+1+4}{6} = \frac{12}{6} = 2 -->
<!-- \end{equation}$$ -->
$sd = \sqrt{D} = \sqrt{2}= 1.4142$

#### 1.5.9 Лекция {#anchor}
**Свойства дисперсии и сдандартного отклонения**

Если к каждому элементу нашей выборки прибавить число $c$, то ни дисперсия
ни стандартное отклонение не изменятся:

$D_{x+c} = D_x$  
$sd_{x+c} = sd_x$

Если каждый элемент нашей выборки умножить на число $c$, то дисперсия увеличится в
$c^2$ раз, а стандартное отклонение увеличится просто в $c$ раз:

$D_{x*c} = D_x*c^2$  
$sd_{x*c} = sd_x*c$

#### 1.5.10 Задача
Рассчитайте среднеквадратическое отклонение данных выборочных значений:

$\begin{array}{rrrrrrrrrr} 1 &5 &2 &7 &1 &9 &3 &8 &5 &9\end{array}$

Не забудьте, что при расчете дисперсии и среднеквадратичного отклонения мы
вычитаем единицу из общего числа наблюдений!

Решение **1**:
```{r echo = T}
x <- c(1, 5, 2, 7, 1, 9, 3, 8, 5, 9)
L <- length(x)   # кол-во элементов в выборке
M <- mean(x)     # среднее значение выборки
D <- sum((x - M) ^ 2) / (L - 1) #  расчет дисперсии
sd <- sqrt(D)    # расчет стандартного отклонения
print(c(D, sd))  # вывод результатов
```

Решение **2** (используя встроенные ф-ии R):

```{r echo = T}
D <- var(x)     # расчет дисперсии
sd <- sd(x)     # расчет стандартного отклонения
print(c(D, sd)) # вывод результатов
```

#### 1.5.11 Задача
Как соотносятся дисперсии  двух выборок

$$
\begin{array}
{rrrrrrrr}
 1 &3 &5 &6 &6 &7 &9 &11 \\
 5 &7 &9 &10 &10 &11 &13 &15
\end{array}
$$

(Постарайтесь решить данное задание не рассчитывая значения дисперсии,
но воспользовавшись одним из свойств)

Ответы:  
* D2 = D1 * 4  
* **D2 = D1**  
* D2 = D1 + 4  

Каждый элемент второй выборки на 4 единицы больше элемента из первой, значит используя первое
свойство в [1.5.9 Лекция](#anchor) дисперсии она будет одинакова в обеих выборках.

#### 1.5.12 Задача
Как соотносятся стандартные (среднеквадратические) отклонения двух выборок:

$$
\begin{array}
 {rrrrrrrr}
 2 &4 &5 &8 &9 &10 &14 &16 \\
 6 &12 &15 &24 &27 &30 &42 &48
\end{array}
$$
Ответы:  
* SD2 = SD1 / 3  
* SD2 = SD1  
* **SD2 = SD1 * 3**  
* SD2 = SD1 * 9

#### 1.5.13 Задача
Может ли показатель стандартного отклонения принимать отрицательные значения?

Ответы:
* **Не может, стандартное отклонение всегда неотрицательное.**
* Может, если все значений выборки отрицательные.
* Может, если все значения в выборке равны друг другу.
* Не может, стандартное отклонение всегда равно нулю.

### 1.6 Квартили распределения и график box-plot
#### 1.6.1 План урока
* Квантили распределения
* Квартили
* Box plot

#### 1.6.2 Лекция
**Квантили** - это такие значения признака, котрые делят упорядоченные данные 
на некоторое число частей.

Например знакомая нам уже **медиана** делит наши данные на две части.

**Квартили распределения** - это такие три точки, которые делят наши данные 
на четыре равные части.

#### 1.6.3 Лекция

$$
\begin{array}
 {rrrrrrrrrrrrrrr}
 157 &159 &161 &164 &165 &166 &167 &\color{red}{167} &167 &168 &169 &169 &170 &170 &170 \\
 171 &171 &172 &172 &172 &172 &173 &\color{red}{173} &175 &175 &177 &178 &178 &179 &185
\end{array}
$$

**Первый квартиль** - делит половину до медианы пополам, это $167$.

Медиана - **второй квартиль**; она равна $170.4$

**Третий квартиль** - делит половину после медианы пополам, это $173$.  

#### 1.6.4 Лекция
**Boxplot** - визуализация квартилей и не только.

```{r}
quart_1 <- quantile(d$height, 0.25)
quart_3 <- quantile(d$height, 0.75)
iqr <- IQR(d$height)
ggplot(data = d) + 
  geom_boxplot(aes(x = "", y = height), width = 0.4) +
  geom_hline(yintercept = quart_1 - 1.5 * iqr,
             linetype = "dashed", color = "red", alpha = 0.6) +
  geom_hline(yintercept = quart_1,
             linetype = "dashed", color = "red", alpha = 0.6) +
  geom_hline(yintercept = quart_3,
             linetype = "dashed", color = "red", alpha = 0.6) +
  geom_hline(yintercept = quart_3 + 1.5 * iqr,
             linetype = "dashed", color = "red", alpha = 0.6) +
  annotate("text", x = 1.42, y = quart_1 + 1, 
           label = "quartile 0.25", color = "red", alpha = 0.8) +
  annotate("text", x = 1.42, y = quart_3 + 1, 
           label = "quartile 0.75", color = "red", alpha = 0.8) + 
  annotate("text", x = 1, y = 171.5, 
           label = "median", color = "red", alpha = 0.8) +
  annotate("text", x = 1.37, y = quart_1 - 1.5 * iqr + 1, 
           label = "quartile 0.25 - 1.5*IQR", color = "red", alpha = 0.8) + 
  annotate("text", x = 1.37, y = quart_3 + 1.5 * iqr + 1, 
           label = "quartile 0.75 + 1.5*IQR", color = "red", alpha = 0.8) +
  geom_segment(aes(x = 0.7, xend = 0.7, y = quart_1, yend = quart_3),
               color = "red", arrow = arrow(length = unit(0.2, "cm")), size = 0.3) +
  geom_segment(aes(x = 0.7, xend = 0.7, y = quart_3, yend = quart_1),
               color = "red", arrow = arrow(length = unit(0.2, "cm")), size = 0.3) +
  annotate("text", x = 0.67, y = 170, 
           label = "IQR", color = "red", alpha = 0.8) +
  geom_point(data = data.frame(height = c(159, 179)), 
             aes(x = "", y = height), 
             color = "red") +
  annotate("text", x = 1.05, y = 159, label = "159", color = "red", alpha = 0.8) +
  annotate("text", x = 1.05, y = 179, label = "179", color = "red", alpha = 0.8) +
  annotate("text", x = 1.05, y = 185, label = "185", color = "red", alpha = 0.8) +
  annotate("text", x = 1.05, y = 157, label = "157", color = "red", alpha = 0.8)
  
```

На рисунке выше представлен график `boxplot` (черного цвета), который получается при
выполнеии простого кода: `ggplot(data = d) + geom_boxplot()`, все поясняющие 
элементы красного цвета нарисованы отдельно. 

Нижняя и верхняя границы "ящика с усами" это соответственно **первый и третий квартили**.

Разница между ними называется **межквартильным размахом (IQR)**.

Линия в самом ящике - это медиана. 

Вертикальные линии доходят до последних значений (красные точки 159 снизу и 179 сверху), 
попадающих в интервал $\pm 1.5 \times{IQR}$. 

Значения не попавшие в этот интервал называются **выбросами**; черные точки 157 и 185.

#### 1.6.5 Лекция
Если на `boxplot` нанести сами данные, то мы увидим вот такую картину:

```{r}
ggplot(data = d, aes(x = "", y = height)) + 
  geom_boxplot() +
  geom_jitter(position = position_jitter(width = 0.3, height = 0),
              shape = 18, 
              color = "red", 
              alpha = 0.8, 
              size = 2.5)
```

### 1.7 Нормальное распределние
#### 1.7.1 План урока
* Понятие нормального распределения
* Стандартизация
* Правила двух и трех сигм, использование стандартизации

#### 1.7.2 Лекция
**Нормальнрое распределение** - унимодально, симметрично; подчиняется 
вероятностному закону отклонения наблюдений от среднего значения.

От $\mu$ (среднее) до $1\sigma$ - $34,1\%$  
От $1\sigma$ до $2\sigma$ - $13.6\%$  
От $2\sigma$ до $3\sigma$ - $2.1\%$  
Свыше $3\sigma$ - $0.1\%$

Для отрицательной половины те же цифры.

#### 1.7.3 Лекция
**Z-преобразование**  или **Стандартизация** - преобразование полученных данных 
в стандартную Z-шкалу (Z-scores), где среднее значение это $0$, а $\sigma$ это $1$

#### 1.7.4 Задача
Если отдельное наблюдение в нашей выборке равняется 1000, при условии, что выборочное среднее равняется  10, то такое наблюдение:

* Можно рассматривать как необычное (выброс), т.к. оно очень далеко отклоняется от среднего значения
* Такое наблюдение в принципе не может принадлежать выборке со средним значением равным 10, так как в 100 раз больше, чем выборочное среднее, а вероятность такого события стремится к нулю
* **Чтобы судить о том, насколько необычным является это наблюдение, необходимо знать, чему равняется стандартное отклонение.**

#### 1.7.5 Лекция
Формула для преобразования в **Z-score**
$$z_i=\frac{x_i-\bar{x}}{\sigma_x}$$

B для выборки:
$$z_i=\frac{x_i-\bar{X}}{sd_x}$$

Проверим вычитание среднего для среднего и деление на сигму для дисперсии:

$$\bar{x}-c=\bar{x}-\bar{x}=0$$

$$D_x\times\Big(\frac{1}{\sigma_x}\Big)^2=D_x\times\frac{1}{D_x}=1$$

Давайте сравним графики до и после z-преобразования:

```{r, echo = TRUE, fig.height = 3}
# Основа для графиков
g2 <- ggplot() + scale_y_continuous(limits = c(0, 12.1), breaks = seq(0, 12, 4))
# Изначальный график
g2 + geom_dotplot(data = d, aes(height))
# График преобразованный в Z-score
g2 + geom_dotplot(data = d, aes(scale(height)))
```

#### 1.7.6 Задача
Z - преобразование часто используется, чтобы все наблюдения перевести в z - шкалу (M = 0, sd = 1) для упрощения работы с данными. Однако иногда нам необходимо рассчитать z - значение только для отдельно взятого наблюдения, чтоб выяснить насколько далеко оно отклоняется от среднего значения в единицах стандартного отклонения.

Вернемся к нашему примеру с ростом людей. Допустим, мы измерили рост 1000 человек, данное распределение оказалось нормальным со средним равным 175 и стандартным отклонением равным 8 (M = 175, sd = 8). Рост одного из испытуемых составил 186,2. Чему равняется **z - значение**, рассчитанное для этого испытуемого?

```{r, echo = TRUE}
M <- 175
sd <- 8
x_i <- 186.2

(z_i <- (x_i - M)/sd)
```

#### 1.7.7 Задача
Если отдельное наблюдение меньше, чем выборочное среднее, то соответствующее **z - значение** будет:

* **отрицательным**
* положительным
* нулем
* в зависимости от значения стандартного отклонения возможны все три варианта

#### 1.7.8 Задача
Выберите верные утверждения (одно или несколько):

* Z значение может быть рассчитано без знания стандартного отклонения по выборке
* Z значение не может быть больше трех
* **Для каждого наблюдения в выборке можно рассчитать соответствующее z значение**
* **Если для некоторого наблюдения z значение равняется нулю, следовательно это наблюдение совпадает со средним значением по выборке**

#### 1.7.9 Лекция
**Правило "двух" и "трех" сигм**

$M_x \pm \sigma \approx 68\%$ наблюдений  
$M_x \pm 2\sigma \approx 95\%$ наблюдений  
$M_x \pm 3\sigma \approx 100\%$ наблюдений  

#### 1.7.10 Лекция
Z-преобразование позволяет нам ответить на вопрос какой процент наблюдений 
лежит в интересующем нас диапазоне.

Допустим у нас есть выборка со средним равным 150, стандартной ошибкой равной 8 и 
мы хотим узнать процент наблюдений превосходящих значение 154.

Для начала сделаем z-преобразование: $$z=\frac{154-150}{8}=0.5$$

Смотрим специальную таблицу [Complementary cumulative](https://en.wikipedia.org/wiki/Standard_normal_table), 
либо решаем в R:
```{r, echo = T}
pnorm(q = 154, mean = 150, sd = 8, lower.tail = FALSE)
```

т.е. вероятность примерно 30%.

Вероятность встретить значение превосходящее 0,5 по z-шкале составляет приблизительно 30%

#### 1.7.11 Задача
Допустим, что некоторый признак распределен нормально, выборочное среднее 
равняется 100, а дисперсия равняется 25 (M = 100, D = 25). Тогда приблизительно 
95% всех наблюдений находится в диапазоне:

* от 50 до 100
* от 50 до 150
* **от 90 до 110**

т.е. $95\%\ попадают\ в\  M\pm2\sigma = M\pm2\sqrt{D}=100\pm2\sqrt{25}=100\pm10$

#### 1.7.12 Задача
Считается, что значение IQ (уровень интеллекта) у людей имеет нормальное 
распределение со средним значением равным 100 и стандартным отклонением 
равным 15 (M = 100, sd = 15).

Какой приблизительно процент людей обладает IQ > 125?

```{r, echo = T}
pnorm(q = 125, mean = 100, sd = 15, lower.tail = F)
# или вот так
1 - pnorm(q = 125, mean = 100, sd = 15)
```

Ответ: примерно 5%

#### 1.7.13 Задача
Считается, что значение IQ (уровень интеллекта) у людей имеет нормальное 
распределение со средним значением равным 100 и стандартным отклонением 
равным 15 (M = 100, sd = 15).

Какой приблизительно процент людей обладает IQ  на промежутке от 70 до 112 

Решение: необходимо вычесть из вероятности превышения 70 вероятность превышения 112

```{r, echo = T}
pnorm(q = 70, mean = 100, sd = 15, lower.tail = F) - 
  pnorm(q = 112, mean = 100, sd = 15, lower.tail = F)
```

Ответ: примерно 77%

### 1.8 Центральная предельная теорема
#### 1.8.1 План урока
[Ссылка](https://gallery.shinyapps.io/CLT_mean/) на сайт с симуляцией данных для центральной предельной теоремы

#### 1.8.2 Лекция
В ситуации нормального распределения мы без труда сможем рассчитать вероятность того,
что отклонения от среднего превысит некую величину.

Держа в уме это правило, давайте познакомимся с **ЦПТ** которая лежит в основании
самой идеи статистической проверки гипотез и наконец разберемся, что означает фраза 
*"Статистически значимое различие"*

#### 1.8.3 Лекция
#### 1.8.4 Лекция
#### 1.8.5 Задача
Если увеличить размер выборки, то сильные отклонения выборочных средних от 
истинного среднего будут возникать

* Чаще, распределение выборочных средних станет более широким
* **Реже, распределение выборочных средних станет более узким** 
* Это не повлияет на характер распределения выборочных средних

#### 1.8.6 Лекция
Давайте сформулируем **ЦПТ**.

Предположим исследуемы нами признак имеет нормальное распределение **ГС** со 
средним значением ($\mu=0$) и стандартным отклонением ($\sigma=20$) 

Мы многократно извлекаем $m$ выборок с объемом наблнюдений $n$. Для каждой выборки находим 
её среднее значение $\bar{X_1},\bar{X_2}...\bar{X_m}$ и построим распределение этих
выборочных средних. 

Так вот  такое распределение будет являться **нормальным** со средним 
совпадающим со значением среднего в **ГС** $M=\mu$ и со стандартным отклонением 
от среднего, которое называется **стандартной ошибкой среднего**: $$se=\frac{\sigma}{\sqrt{n}}$$

Чем больше наблюдений в выборке, тем ближе все выборочные средние к 
реальному среднему **ГС**. Поэтому изменчивость всех выборочных средних будет 
тем больше, чем меньше элементов в **ГС**. И чем меньше изменчивость признака в **ГС**,
тем реже будут возникать сильные отклонения выборочных средних от среднего в **ГС**.

Чем больше число наблюдений ($\sqrt{n}$) и чем меньше изменчивость **ГС** ($\mu$),
тем меньше будет **стандартная ошибка среднего** ($se$).

Если число элементов в выборке $n>30$, выборка репрезентативна, то вместо стандартного отклонения
**ГС** можно использовать стандартное отклонение нашей выборки:
$$se=\frac{sd_x}{\sqrt{n}}$$
Предположи мы сделали одну выборку со значениями $n=100; sd= 5; \bar{X}=3$. 
основываясь на данных только одной выборки мы можем предположить как бы вели себя 
все выборочные средние, если бы мы многократно повторяли выборку. 
$$se=\frac{5}{\sqrt{100}}=0.5$$

Так, имея на руках только одну выборку мы можем предсказать как бы вели себя все 
выборочные средние; они распределились бы вокруг среднего **ГС** $M$ (нам не известного)
со стандартной ошибкой среднего $se=0.5$

#### 1.8.7 Задача
Рассчитайте стандартную ошибку среднего, если выборочное среднее равняется 10, дисперсия 4, при N = 100
```{r, echo = T}
n <- 100
D <- 4
(se <- sqrt(D/n))
```

#### 1.8.8 Задача
Как соотносятся стандартная ошибка среднего и выборочное стандартное отклонение исследуемого признака?

* Стандартная ошибка всегда больше, чем стандартное отклонение
* Стандартная ошибка всегда равняется стандартному отклонению
* **Стандартная ошибка всегда меньше, чем стандартное отклонение**

### 1.9 Доверительные интервалы для среднего
#### 1.9.1 План урока
#### 1.9.2 Лекция
Наша первая статистическая задача для решения которой потребуется знание **ЦПТ**
будет связана с построением доверительных интервалов для среднего значения.

Мы начали с того, что целью статистики является возможность сделать выводы 
о **ГС**, основываясб только на выборочных данных.

Нас интересует чему равняется среднее значение исследуемого признака в **ГС**.

Давайте рассмотрим следующий пример:

Уровень экспрессии некоторого гена измерялся в эксперименте. 
Ниже представлены результаты 64 наблюдений.

В исследовании приняли участие мужчины и женщины в возрасте от 18 до 30 лет.
У них измерили уровень экспресии некоторого гена.

```{r}
gen <- c(102, 91, 99, 100, 103, 98, 99, 101, 106, 88, 103, 97, 103, 101,
       101, 91, 104, 105, 105, 100, 101, 91, 99, 98, 107, 102, 100, 97,
       98, 104, 100, 98, 103, 99, 95, 103, 104, 97, 99, 102, 98, 107, 101,
       93, 98, 101, 93, 91, 107, 102, 96, 93, 100, 105, 103, 107, 99, 102,
       106, 102, 94, 104, 103, 103)
gen
```

```{r, echo = T}
mean(gen) # средне значение
sd(gen)   # стандартное отклонение
```
Нас волнует главный вопрос: *Чему равен показатель среднего значения экспрессии этого гена
во всей генеральной совокупности?*

**ГС** - это все мужчины и женщины в указанном возрастном промежутке.

Мы не сможем сказать, точное значение среднего в **ГС**, но мы сможем рассчитать такой интервал
относительно которого мы можем быть уверены, что в нем есть интересуюший нас параметр.

Итак, мы знаем, то если бы многократно повторяли эксперимент, то все выборочные средние
распределились нормальным образом вокруг среднего **ГС** $М$ со стандартной ошибкой среднего
$se=\dfrac{sd_x}{\sqrt{n}}$. 

И мы так же знаем, что $95\%$ всех выборочных средних лежали бы в диапазоне $\mu\pm1.96\sigma$ или
в нашем случае $\mu\pm1.96se$. Но мы не знаем среднего!

Предположим, что мы рассчитываем показатель для нескольких выборочных средних $\bar{X_1}\pm1.96se$,
$\bar{X_2}\pm1.96se$ и т.д., то эти интервалы включали бы в себя среднее значение **ГС**.

Таким образом $95\%$ всех выборочных средних включили бы в себя среднее **ГС**

**Вот откуда 1,96**: нам нужно найти такой z-score, чтобы слева от него лежало 97,5% данных. Почему 97,5%, а не 95%? Потому что нас интересуют центральные 95% данных (синяя полоска под графиком на слайде), на "хвосты" по бокам, которые нам не интересны остается в сумме 5% (= 100% - 95%) или 2,5% на "хвост" (= 5% / 2). Если мы знаем что справа от правой границы центральных 95% лежит 2,5% данных, то логично что слева от этой границы лежит оставшиеся 97,5% данных (=100% - 2.5%)

```{r, echo = T}
pr <- 95
(koef <- qnorm((100 - (100 - pr)/2)/100))
```

#### 1.9.3 Лекция
Таким образом, если бы мы многократно извлекали бы выборки их **ГС**, в каждой выборки рассчитывали среднее значение,
и для него свой 95% интервал, т.е. $\bar{X}\pm1.96se$, то в 95% всех случаев такой интервал включал бы в себя
среднее значение **ГС**.

Давайте рассчитаем доверительный интервал для нашей выборки:

$\bar{X}=$ `r mean(gen)`  
$sd=$ `r sd(gen)`  
$n=$ `r length(gen)`  

Первое, что нужно вычислить, это стандартную ошибку среднего:  
$se=\dfrac{sd_x}{\sqrt{n}}$

```{r, echo = T}
(se <- sd(gen)/sqrt(length(gen))) # стандартная ошибка среднего
```

А затем уже обе границы доверительного интервала:  
$left=\bar{X}-1.96se$  
$right=\bar{X}+1.96se$

```{r, echo = T}
left <- mean(gen) - koef * se   # левая граница доверительного интервала
right <- mean(gen) + koef * se  # правая граница доверительного интервала
c(left, right)
```

#### 1.9.4 Задача
Если мы рассчитали 95% доверительный интервал для среднего значения, то какие из следующих утверждений являются верными?

* **Если многократно повторять эксперимент, для каждой выборки рассчитывать свой доверительный интервал, то в 95 % случаев истинное среднее будет находиться внутри доверительного интервала.**
* Если многократно повторять эксперимент, то 95 % выборочных средних значений будут принадлежать рассчитанному нами доверительному интервалу.
* **Мы можем быть на 95% уверены, что среднее значение в генеральной совокупности принадлежит рассчитанному доверительному интервалу.**
* Среднее значение в генеральной совокупности точно принадлежит рассчитанному доверительному интервалу.
* Среднее значение в генеральной совокупности точно превышает нижнюю границу 95% доверительного интервала.

#### 1.9.5 Лекция
Можно рассчитать больший доверительный интервал.

```{r, echo = T}
pr <- 99
koef <- qnorm((100 - (100 - pr)/2)/100) # 2.575829
left <- mean(gen) - koef * se   # левая граница доверительного интервала
right <- mean(gen) + koef * se   # правая граница доверительного интервала
c(left, right)
```

В этот интервал среднее **ГС** попадет с вероятностью 99%.

#### 1.9.6 Задача
Если бы в нашем примере мы увеличили объем выборки в два раза (при условии, что показатель стандартного отклонения остался неизменным), то 95% доверительный интервал

* возможны оба варианта
* **стал более узким**
* стал более широким

#### 1.9.7 Задача
В центре 95% доверительного интервала, рассчитанного по выборочным значениям, находится:

* Среднее значение генеральной совокупности
* **Выборочное среднее значение**
* Значение стандартной ошибки среднего

#### 1.9.8 Задача
Рассчитайте 99% доверительный интервал для следующего примера:
x=10, sd=5, n=100

```{r, echo = T}
x_hat <- 10
se <- 5/sqrt(100)
pr <- 99

koef <- qnorm((100 - (100 - pr)/2)/100)
left <- x_hat - koef * se
right <- x_hat + koef * se
c(left, right)
```

### 1.10 Идея статистического вывода, p-уровень значимости
#### 1.10.1 План урока
* Статистическая проверка гипотез
* Идея статистического вывода
* p-уровень значимости и его интерпретация

#### 1.10.2 Лекция
При помощи доверительных интервалов мы научились решать довольно интересную задачу.
А именно оценивать неизвестный параметр в **ГС**. Но это редко когда является самоцелью.
В большинстве случаев насинтересуют конкретные гипотезы. Например различаются ли страны по среднему уровню продолжительности жизни. Или можно ли утверждать, что новое лекарство способствует ускорению выздоровления пациентов.
Давайте разберемся с основной идеей лежащей в основе статистической проверки гипотез.

#### 1.10.3 Лекция
Давайте разберем один из примеров.

Предположим, что на выздоровление при некотором заболевании в среднем необходимо 20 дней.
Однако, мы разработали новый препарат и хотим проверить, можно ли сократить этот срок.
Мы набрали выборку из 64 пациентов и опробовали на них новый метод лечения.
Оказалось, что средний срок выздоровления сократился до 18,5 дней, при стандартном отклонении равном 4.

Какой же вывод можно сделать основываясь на этих данных?

С одной стороны мы сократили срок на выздоровление. С другой стороны интуитивно понятно, что 
даже при отсутствии какого-либо влияния нашего препарата такой результат мог быть получен совершенно случайно.

Давайте введем два очень важных понятия.

Между собою будут конкурировать две гипотезы:  
$H_0$ - нулевая гипотеза говорит о том, что лекарство никак не повлияло на выздоровление.
И среднее значение времени выздоровления **ГС** тех пациентов, кто использует наш новый препарат 
не отличается от дватцати $M_{НП}=20$.

$H_1$ - альтернативная гипотеза, говорящая о том, что наш препарат влияет на выздоровление.
Т.е. $M_{НП}\ne20$

Давайте рассуждать следующим образом, предположим что верна $H_0$. Тогда мы знаем, что в следствии
ЦПТ, если бы мы многократно повторяли наше исследование, то выборочные средние распределились бы нормальным 
образом вокруг среднего генеральной совокупности $M=20$ и со стандартной ошибкой 
$se=\dfrac{sd}{\sqrt{n}}=\dfrac{4}{\sqrt{64}}=0.5$

Теперь давайте ответим на следующий вопрос: насколько далеко наше выборочное среднее отклонилось от среднего значения в **ГС** в единицах стандартного отклонения?

Для этого сделаем z-преобразование. 
$$Z=\frac{\bar{X}-M}{se}=\frac{18.5-20}{0.5}=-3$$

Это означает, что если бы в **ГС** среднее значение на самом деле равнлось бы 20,
то наше выборочное среднее отклонилось бы от среднего **ГС** на -3 сигмы в левую сторону

#### 1.10.4 Лекция
#### 1.10.5 Лекция
А теперь давайте рассчитаем вероятность такого отклонения $\left(\pm3\sigma\right)$:

Решение подсмотрел [тут](http://www.cyclismo.org/tutorial/R/pValues.html).

```{r, echo = T}
x_hat <- 18.5
M <- 20
sd <- 4
n <- 64

se <- sd/sqrt(n)
z <- (x_hat - M)/se

p1 <- 2*pnorm(-(abs(z))) # хз зачем тут минус(
p2 <- 2*pnorm(x_hat, mean = M, sd = sd/sqrt(n))
c(p1, p2)
```

Получилась вероятнось отклонения от среднего на три стандартных отклонения (как в правую так и в левую стороны)
равняется приблизительно трем тысячным.

На первом этапе мы предположили, что верна $H_0$. Если это так, тогда все выборочные средние 
распределились бы нормальным образом вокруг среднего генеральной совокупности $M=20$.
В нашем эксперименте, однако, наше выборочное среднее оказалось равно $\bar{X}=18.5$
Зная стандартную ошибку среднего ($se$) мы смогли рассчитать вероятность такое или еще более сильное отклонение
как в правую так и в левую стороны. Оказалось, что вероятность такого события $p=0.003$

#### 1.10.6 Лекция
Таким образом, основная идея статистического вывода заключается в следующем.
Сначала мы допускае, что верна нулевая гипетеза. После этого находим вероятность того,
что мы получили такие или еще более выраженные различия абсолютно случайно.

Эта вероятность в статистике называется **p-уровень значимости**.

И именно при помощи этого показателя мы выясним какую же гипотезу в нашем исследовании 
считать наиболее обстоятельной.

Чем **меньше** p-уровень, тем больше оснований **отклонить** $H_0$.

Считатеся, если $p<0,05$, то можно принимать альтернативную гипотезу.

Однако, если $p>0,05$ считается, что у нас не достаточно оснований отклонить нулевую гипотезу

#### 1.10.9 Лекция
P-уровень значимости не позволяет нам сказать о том, с какой вероятностью верна $H_0$.

#### 1.10.12 Задача
Использование доверительных интервалов зачастую рассматривают, как альтернативный способ проверки гипотез. В нашем случае, если значение 20 (предполагаемое среднее значение в генеральной совокупности) не будет принадлежать 95% доверительному интервалу, рассчитанному по выборочным данным, у нас будет достаточно оснований отклонить нулевую гипотезу. Проверьте согласуются ли результаты двух этих подходов: рассчитайте 95% доверительный интервал для среднего значения, на примере с тестированием нового препарата.

n = 64,  sd = 4,   M = 18.5

```{r, echo = T}
n <- 64
sd <- 4
x_hat <- 18.5
se <- sd/sqrt(n)
pr <- 95

koef <- qnorm((100 - (100 - pr)/2)/100)
left <- x_hat - koef * se
right <- x_hat + koef * se
c(left, right)
```

Ответ: 20 не попадает в интервал, поэтому отклоняем $H_0$

#### 1.10.13 Задача
Данные некоторого исследования сообщают нам, что средний рост детей в 10 лет составляет 136 сантиметров. Однако это лишь выборочная оценка, и исследователи рассчитали 99% доверительный интервал, который составил [130, 142]. Укажите верные утверждения:

* **У нас достаточно оснований отклонить нулевую гипотезу, что среднее в генеральной совокупности равняется 143**
* Доверительный интервал не может иметь такие границы, т. к. выборочное стандартное отклонение равняется 10, следовательно доверительный интервал должен быть значительно шире.
* **У нас достаточно оснований отклонить нулевую гипотезу, что среднее в генеральной совокупности равняется 128.**
* Вероятность того, что истинное среднее значение больше 142, составляет 0,01

#### 1.10.14 Задача
Предположим, нулевой гипотезой вашего исследования являлось предположение, что среднее в генеральной совокупности равняется 100. Вы получили p = 0,12 и не смогли отклонить нулевую гипотезу. Однако позже выяснилось, что среднее в генеральной совокупности равняется 114. Как можно описать результаты данного исследования?

* Вы не совершали ни ошибку первого рода, ни ошибку второго рода.
* **Вы совершили ошибку второго рода**
* Вы совершили ошибку первого рода

#### 1.10.15 Задача
В среднем слушатели курса по введению в статистику набирают 115 баллов, однако, в 2015 году средний балл  случайно выбранных 144 участников составил 118 со стандартным отклонением равным 9. Рассчитайте p уровень значимости для проверки нулевой гипотезы о том, что среднее значение баллов в 2015 году равняется 115.

```{r, echo =T}
x_hat <- 118
n <- 144
sd <- 9
M <- 115

p1 <- 2*pnorm(x_hat, mean = M, sd = sd/sqrt(n))
p2 <- 2*pnorm(M, mean = x_hat, sd = sd/sqrt(n)) # вроде это значение правильное
c(p1, p2)
```

## 2. Сравнение средних (вторая неделя)
### 2.1 T-распределение
#### 2.1.1 План урока
* Нормальное распределение и ограниченность количества наблюдений
* Распределение Стьюдента (Т-распределение)
* Понятие числа степеней свободы

#### 2.1.2 Лекция
Итак, мы познакомились с основной идеей статистической проверки гипотез. Основываясь на **ЦПТ**
мы могли предположить, как бы вели себя все выборочные средние, если бы мы многократно повторяли наш эксперимент, и основываясь на этой информации рассчитать вероятность получить такое или еще более выраженное отклонение, чем в нашем исследовании.

Если мы знаем, что в нашей **ГС** среднее равняется нулю, а стандартное отклонение равняется единице,
и мы многократно извлекаем выборки из **ГС**, товсе средние значения этих выборок распределятся нормальным образом вокруг среднего **ГС** со стандартной ошибкой $se=\frac{\sigma}{\sqrt{n}}$, где $n$ - размер выборки.

Это все очень хорошо и очень удобно, пока у нас достаточно большое коичество наблюдений. Тогда
все выборочные средние буду вести себя в соответствии с нормальным распределением.

Однако, все становится гораздо интереснее при малом количестве наблюдений, $N<30$. Нарушается предположение о том, что все выборочные будут вести себя **нормально**.

#### 2.1.3 Лекция
Давайте разберемся, почему это произойдет. 
